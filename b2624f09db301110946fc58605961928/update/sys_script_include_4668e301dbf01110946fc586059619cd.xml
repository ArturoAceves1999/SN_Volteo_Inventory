<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_776815_inventory.GlideAjaxInventory2</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description/>
        <name>GlideAjaxInventory2</name>
        <script><![CDATA[var GlideAjaxInventory2 = Class.create();
GlideAjaxInventory2.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {

	IdentifyProduct: function() {
        var barcodeProduct = this.getParameter('barcode');
        var nameProduct = "no item";
        var quantity = 0;
        var grinventory = new GlideRecord('x_776815_inventory_inventory_db_v2');
        grinventory.addEncodedQuery("code=" + barcodeProduct);
        grinventory.query();
        if (grinventory.next()) {
            nameProduct = grinventory.product;
            quantity = grinventory.quantity;

        }

        var json = new JSON();
        var information = {
                'name': nameProduct.toString(), //first value I need to pass back
                'quantity': quantity.toString() //second value I need to pass back
            },
            data = json.encode(information);
		gs.log("Tenemos: " + information);
        return JSON.stringify(information);
    },

    UpdateNewQuantity: function() {
        var checkOut = [];
        checkOut = this.getParameter('list_item');
        checkOut = new JSON().decode(checkOut);
        gs.log("Recibio items: " + checkOut.length);
        gs.log("Item 1:" + checkOut[0] + "Item 2: " + checkOut[1]);
        for (i = 0; i < checkOut.length; i++) {
            gs.log("El iterador es: " + i);
            var grloc = new GlideRecord('x_776815_inventory_inventory_db_v2');
            grloc.addEncodedQuery('product=' + checkOut[i].name);
            grloc.query();
            if (grloc.next()) {
                if (grloc.quantity < checkOut[i].quantity) {
                    grloc.quantity = 0;
                } else {
                    grloc.quantity = grloc.quantity - checkOut[i].quantity;
                }
                grloc.update();
            }
        }

        return checkOut;

    },
	
    type: 'GlideAjaxInventory2'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>Arturo.aceves</sys_created_by>
        <sys_created_on>2022-07-18 18:19:54</sys_created_on>
        <sys_id>4668e301dbf01110946fc586059619cd</sys_id>
        <sys_mod_count>3</sys_mod_count>
        <sys_name>GlideAjaxInventory2</sys_name>
        <sys_package display_value="Inventory DB V2" source="x_776815_inventory">b2624f09db301110946fc58605961928</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Inventory DB V2">b2624f09db301110946fc58605961928</sys_scope>
        <sys_update_name>sys_script_include_4668e301dbf01110946fc586059619cd</sys_update_name>
        <sys_updated_by>Arturo.aceves</sys_updated_by>
        <sys_updated_on>2022-07-18 19:24:48</sys_updated_on>
    </sys_script_include>
</record_update>
